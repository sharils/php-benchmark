#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

$profiler = new Sharils\Profiler();
$profiler->setUp($argv[1]);
$profiler->tearDown($argv[2]);
$profiles = $profiler->profile(array_slice($argv, 3));
foreach ($profiles as $profile) {
    $profile->filename = "php $profile->filename";
    $profile->php = "php -r '{$argv[1]}; $profile->snippet; {$argv[2]};'";
    $profile->ratio = round($profile->time / $profiles[0]->time * 100) . '%';
    $profile->time .= ' (average seconds)';
    foreach (['snippet', 'filename', 'php', 'time', 'ratio'] as $profileKey) {
        printf("%8s: %s\n", $profileKey, $profile->$profileKey);
    }
    echo PHP_EOL;
}
